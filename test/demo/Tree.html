<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tree</title>
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <style>
        body {
            padding: 50px;
        }
        .tree {
            position: relative;
        }
        .node > label {
            display: inline-block;
            padding: 1px 3px;
            border-radius: 4px;
        }
        .tree.active > .node label {
            background-color: red;
            color: #FFF;
        }
        .sub-tree {
            padding-left: 20px;
            display: none;
        }
        .expanded > .sub-tree,
        .expanded > .sub-tree > .tree {
            display: block;
        }
        .sub-tree:after {
            position: absolute;
            left: -13px;
            top: 9px;
            content: '';
            height: 1px;
            width: 26px;
            background-color: #CCC;
        }
        .node + .sub-tree:after {
            position: absolute;
            left: 6px;
            top: 0;
            content: '';
            height: 100%;
            width: 1px;
            background-color: #CCC;
        }
    </style>
</head>
<body>

    <div class="tree">

    </div>

    <script src="./js/jquery.js"></script>
    <script src="./js/esl.js"></script>
    <script src="./js/config.js"></script>
    <script>

        require(

            [
                'cobble/ui/Tree',
                'cobble/util/etpl'
            ],

            function (Tree, etpl) {

                window.tree = new Tree({

                    mainElement: $('.tree'),

                    data: [
                        {
                            id: '1-0',
                            text: '1-0',
                            children: [
                                {
                                    id: '1-1',
                                    text: '1-1'
                                },
                                {
                                    id: '1-2',
                                    text: '1-2',
                                    children: [
                                        {
                                            id: '1-2-1',
                                            text: '1-2-1'
                                        },
                                        {
                                            id: '1-2-2',
                                            text: '1-2-2',
                                            children: [
                                                {
                                                    id: '1-2-2-1',
                                                    text: '1-2-2-1'
                                                },
                                                {
                                                    id: '1-2-2-2',
                                                    text: '1-2-2-2'
                                                },
                                                {
                                                    id: '1-2-2-3',
                                                    text: '1-2-2-3'
                                                },
                                                {
                                                    id: '1-2-2-4',
                                                    text: '1-2-2-4'
                                                },
                                            ]
                                        }
                                    ]
                                },
                                {
                                    id: '1-3',
                                    text: '1-3'
                                },
                                {
                                    id: '1-4',
                                    text: '1-4'
                                }
                            ]
                        },
                        {
                            id: '2-0',
                            text: '2-0',
                            children: [
                                {
                                    id: '2-1',
                                    text: '2-1'
                                },
                                {
                                    id: '2-2',
                                    text: '2-2'
                                },
                                {
                                    id: '2-3',
                                    text: '2-3'
                                },
                                {
                                    id: '2-4',
                                    text: '2-4'
                                }
                            ]
                        }
                    ],

                    labelSelector: '.node',
                    toggleSelector: '.glyphicon',

                    activeClass: 'active',
                    expandedClass: 'expanded',
                    collapsedClass: 'collapsed',

                    nodeSelector: '.tree',

                    nodeTemplate: '<div class="tree'
                                + '<!-- if: ${cache.parent} -->'
                                +     ' sub-tree" data-parent-id="${cache.parent.id}"'
                                + '<!-- else -->'
                                +     '"'
                                + '<!-- /if -->'
                                + ' data-id="${node.id}" data-level="${cache.level}">'
                                +     '<div class="node">'
                                +         '<i class="glyphicon glyphicon-chevron-up"></i>'
                                +         '<label>${node.text}</label>'
                                +     '</div>'
                                +     '<!-- if: ${node.children} -->'
                                +     '<div class="tree sub-tree">${childrenView|raw}</div>'
                                +     '<!-- /if -->'
                                + '</div>',

                    renderTemplate: function (data, tpl) {
                        return etpl.compile(tpl)(data);
                    },

                    onbeforeexpand: function (e, data) {
                        console.log('before expand', data);
                    },
                    onafterexpand: function (e, data) {
                        console.log('after expand', data);
                    },
                    onbeforecollapse: function (e, data) {
                        console.log('before collapse', data);
                    },
                    onaftercollapse: function (e, data) {
                        console.log('after collapse', data);
                    },

                    onchange: function (event, data) {
                        console.log(data);
                    }
                });

            }
        );
    </script>
</body>
</html>